<script>
var behancekey = "eDUpmeKPYEe7yzspt2otnmOXozqZa0aG";

var behanceAPI = function() {
    var key;
    var baseURL = "//www.behance.net/v2/";
    var userProjects = new Array();
    var offsetPage = 1; // optionally you can set up which page to start
    var numPages = 2; // Set up the max of pages to retrieve from behance (Each page gets 10 items max).

    function setKey(k) {
        key = k;
    }

    function getProjects(user, cb) {
        var url = "";
        $.each([offsetPage, numPages], function(i, numb) {

            url = baseURL + "users/" + user + "/projects?api_key=" + key + "&callback=&page=" + numb;

            $.get(url, {}, function(res, code) {
                $.each(res.projects, function(i, obj) {
                    userProjects.push(obj);
                });
            }, "JSONP").done(function() {
                cb(userProjects);

            });

        });
    }

    function getProjectDetails(project, cb) {
        var url = baseURL + "projects/" + project + "?api_key=" + key + "&callback=";
        $.get(url, {}, function(res, code) {
            cb(res.project);
        }, "JSONP");
    }

    return {
        setKey: setKey,
        getProjects: getProjects,
        getProjectDetails: getProjectDetails

    };

}();

var username = "rafaeltome";

function loadProject(projectID) {
    behanceAPI.getProjectDetails(projectID, function(loadModules) {
        var moduleHTML = "";

        var moduleTitle = "";
        moduleTitle += "<h1>" + loadModules.name + "</h1>";
        $(".module-title").html(moduleTitle);

        var moduleDescription = "";
        moduleDescription += "<p>" + loadModules.description + "</p>";
        $(".module-description").html(moduleDescription);

        var moduleFields = "";
        moduleDescription += "<p>" + loadModules.fields + "</p>";
        $(".module-fields").html(moduleFields);

        for (var i = 0; i < loadModules.modules.length; i++) {
            if (loadModules.modules[i].src != undefined) {
                moduleHTML += "<li><img src='" + loadModules.modules[i].src + "'></li>";
            }
        }
        $(".modules").html(moduleHTML);
    });
}

$(document).ready(function() {
    behanceAPI.setKey(behancekey);

    // Get projects
    behanceAPI.getProjects("rafaeltome", function(projectlist) {
        var projectHTML = "";
        for (var i = 0; i < projectlist.length; i++) {
            var project = projectlist[i];
            projectHTML += "<li class='portfolio-item column is-one-quarter-desktop is-half-tablet'><a href='#' onclick='loadProject(" + project.id + ")'><img src='" + project.covers[404] + "'></a></li>";
        }
        $(".projects").html(projectHTML);
    });
});

</script>
